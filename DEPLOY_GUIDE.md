# Руководство по развертыванию проекта на хостинге reg.ru

## Подготовка

### Необходимые инструменты
1. **FTP-клиент** (FileZilla или аналогичный)
2. **SSH-клиент** (PuTTY для Windows или встроенный терминал для Mac/Linux)
3. **Архиватор** (для упаковки проекта перед загрузкой - опционально)

### Данные для подключения
- **FTP**:
  - Хост: 37.140.192.190
  - Логин: u3070370
  - Пароль: owKdoEj33BVo98Ht
  - Порт: 21

- **SSH**:
  - Хост: 37.140.192.190
  - Логин: u3070370
  - Пароль: 5aWYle0MX30q2FlP
  - Порт: 22

- **Панель управления ISPManager**:
  - URL: https://server101.hosting.reg.ru:1500/
  - Логин: u3070370
  - Пароль: 5aWYle0MX30q2FlP

## Этап 1: Настройка домена в ISPManager

1. Войдите в панель управления ISPManager по указанному URL
2. Перейдите в раздел "WWW доменов"
3. Выберите домен "prava-online-shop.ru" или создайте новый, если он не существует
4. Настройте следующие параметры:
   - Имя: prava-online-shop.ru
   - Псевдонимы: www.prava-online-shop.ru
   - IP-адрес: 37.140.192.190, 2a00:f940:2:2:1:1:0:101
   - SSL-порт: 443
   - Индексная страница: index.html
   - Версия PHP: PHP 8.2

5. Включите SSL:
   - Перейдите на вкладку "SSL" для домена
   - Выберите "Добавить бесплатный SSL-сертификат Let's Encrypt"
   - Выберите оба домена: prava-online-shop.ru и www.prava-online-shop.ru
   - Нажмите "Сохранить"

## Этап 2: Загрузка файлов через FTP

1. Запустите FTP-клиент (например, FileZilla)
2. Подключитесь к серверу, используя указанные выше данные для FTP
3. Перейдите в директорию `/www/prava-online-shop.ru/`
4. Загрузите все файлы проекта:
   - `.htaccess`
   - `passenger_wsgi.py`
   - `index.html`
   - `setup_hosting.sh`
   - `backup.sh`
   - `fix_https.sh`
   - Директории: `server/`, `js/`, `css/`, `images/`, `russia/` и т.д.

## Этап 3: Настройка проекта через SSH

1. Подключитесь к серверу по SSH:
   ```bash
   ssh u3070370@37.140.192.190
   # Введите пароль: 5aWYle0MX30q2FlP
   ```

2. Перейдите в директорию сайта:
   ```bash
   cd /www/prava-online-shop.ru
   ```

3. Установите права на исполнение для скриптов:
   ```bash
   chmod +x setup_hosting.sh
   chmod +x backup.sh
   chmod +x fix_https.sh
   ```

4. Запустите скрипт исправления HTTP-ссылок:
   ```bash
   ./fix_https.sh
   ```

5. Запустите скрипт настройки проекта:
   ```bash
   ./setup_hosting.sh
   ```

6. Проверьте наличие ошибок в логах:
   ```bash
   cat python_error.log
   ```

## Этап 4: Проверка работоспособности

1. Откройте в браузере https://prava-online-shop.ru
2. Убедитесь, что главная страница загружается корректно
3. Проверьте работу виджета чата (если он есть на странице)
4. Проверьте доступность административной панели:
   - Откройте https://prava-online-shop.ru/admin
   - Войдите с логином: admin
   - Пароль: admin123
   - **Важно**: Смените пароль администратора после первого входа!

## Этап 5: Настройка регулярного резервного копирования

1. Добавьте задание в cron:
   ```bash
   crontab -e
   ```

2. Добавьте строку для ежедневного резервного копирования в 3 часа ночи:
   ```
   0 3 * * * /www/prava-online-shop.ru/backup.sh
   ```

3. Сохраните и закройте редактор (Ctrl+O, Enter, Ctrl+X в nano)

## Решение возможных проблем

### Проблема: Ошибка "Подключение не защищено"
1. Проверьте настройки SSL в ISPManager
2. Убедитесь, что все ссылки в коде используют HTTPS вместо HTTP:
   ```bash
   ./fix_https.sh
   ```
3. Проверьте, что сертификат успешно выпущен:
   ```bash
   openssl s_client -connect prava-online-shop.ru:443 -servername prava-online-shop.ru </dev/null 2>/dev/null | openssl x509 -noout -dates
   ```

### Проблема: Ошибка 500 (Internal Server Error)
1. Проверьте логи Python:
   ```bash
   cat python_error.log
   ```
2. Проверьте логи Apache:
   ```bash
   tail -100 /var/log/apache2/error.log
   ```
3. Убедитесь, что файл passenger_wsgi.py имеет правильные права:
   ```bash
   chmod 755 passenger_wsgi.py
   ```
4. Проверьте, что виртуальное окружение создано и работает:
   ```bash
   ls -la venv/
   source venv/bin/activate
   python -V
   ```

### Проблема: WebSocket не работает
1. Свяжитесь с технической поддержкой reg.ru для уточнения поддержки WebSocket
2. Если WebSocket не поддерживается, модифицируйте код чата для работы через long-polling

## Регулярное обслуживание

1. **Резервное копирование**: ежедневное автоматическое через cron
2. **Мониторинг логов**:
   ```bash
   cat python_error.log
   ```
3. **Обновление кода**:
   - Загрузите новые файлы через FTP
   - Повторно запустите setup_hosting.sh при необходимости

## Заключение

После выполнения всех шагов ваш проект должен быть успешно развернут на хостинге reg.ru. Регулярно проверяйте логи на наличие ошибок и следите за состоянием SSL-сертификата (срок действия - 90 дней, но Let's Encrypt должен обновляться автоматически).

В случае возникновения проблем обращайтесь в техническую поддержку reg.ru или к разработчику проекта. 