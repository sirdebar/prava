# Инструкция по развертыванию на хостинге reg.ru

## Предварительные требования

1. Аккаунт на reg.ru с поддержкой:
   - Python 3.7 или выше
   - WSGI (Passenger или uWSGI)
   - SQLite3
   - Виртуальные окружения Python (venv)

2. Домены: 
   - prava-online-shop.ru (основной)
   - online-prava-shop.ru (дополнительный)

## Шаги по деплою

### 1. Подготовка проекта

Все файлы проекта должны быть предварительно модифицированы с учетом хостинга, включая:
- Изменение URL с localhost на prava-online-shop.ru
- Настройка путей к базе данных
- Создание wsgi-файлов

### 2. Создание сайта на хостинге

1. Войдите в панель управления reg.ru
2. Создайте новый сайт с поддержкой Python
3. Привяжите к нему домены prava-online-shop.ru и online-prava-shop.ru

### 3. Загрузка файлов

1. Подключитесь к хостингу через FTP:
   ```
   Хост: ftp.prava-online-shop.ru
   Пользователь: [ваш_логин]
   Пароль: [ваш_пароль]
   ```

2. Загрузите все файлы проекта в корневую директорию сайта

### 4. Настройка Python и окружения

1. Подключитесь к хостингу через SSH:
   ```
   ssh [ваш_логин]@prava-online-shop.ru
   ```

2. Перейдите в директорию с проектом и запустите скрипт настройки:
   ```
   cd ~/путь_к_проекту
   chmod +x setup_hosting.sh
   ./setup_hosting.sh
   ```

3. Проверьте, что файл passenger_wsgi.py имеет права на выполнение:
   ```
   chmod 755 passenger_wsgi.py
   ```

### 5. Настройка домена и SSL

1. В панели управления reg.ru:
   - Перейдите в раздел "Домены" -> prava-online-shop.ru
   - Активируйте SSL-сертификат Let's Encrypt для обоих доменов

2. Настройте основной домен как prava-online-shop.ru, а online-prava-shop.ru как редирект:
   - В панели управления -> Сайты -> prava-online-shop.ru -> Настройки
   - Добавьте домен online-prava-shop.ru как зеркало с редиректом на prava-online-shop.ru

### 6. Проверка работоспособности

1. Откройте в браузере https://prava-online-shop.ru - должна загрузиться главная страница
2. Проверьте работу чата на сайте
3. Проверьте доступность административной панели по адресу https://prava-online-shop.ru/admin

### 7. Решение возможных проблем

#### Проблемы с правами доступа:
```
chmod 755 -R ~/путь_к_проекту
chmod 664 ~/путь_к_проекту/chat_db.sqlite
chmod 755 ~/путь_к_проекту/passenger_wsgi.py
```

#### Если не загружается сайт или 500 ошибка:
1. Проверьте логи ошибок в панели управления хостингом
2. Убедитесь, что passenger_wsgi.py имеет правильный путь к Python и к приложению
3. Проверьте доступность модулей Python в виртуальном окружении:
   ```
   source ~/путь_к_проекту/venv/bin/activate
   pip list
   ```

#### Проблемы с WebSocket:
К сожалению, не все хостинги поддерживают WebSocket. Если возникают проблемы:
1. Свяжитесь с технической поддержкой reg.ru для уточнения поддержки WebSocket
2. Если WebSocket не поддерживается, отредактируйте код чата для работы через long-polling

## Обслуживание

### Резервное копирование:
```
# Резервное копирование базы данных
cp ~/путь_к_проекту/chat_db.sqlite ~/backups/chat_db_$(date +%Y-%m-%d).sqlite
```

### Обновление кода:
1. Загрузите обновленные файлы через FTP
2. При необходимости обновите зависимости:
   ```
   source ~/путь_к_проекту/venv/bin/activate
   pip install -r ~/путь_к_проекту/server/requirements.txt
   ```
3. Перезапустите приложение через панель управления хостингом 